# Change Log

All notable changes to the "Lim Code" extension will be documented in this file.


## [1.0.77] - 2026-02-06

### Fixed
  - 修复读取非文本类文件时传入行号导致的问题

## [1.0.76] - 2026-02-06

### Improved
  - 优化了编辑框的显示
  - 去除了等待字体的首字母花体效果

## [1.0.75] - 2026-02-06

### Improved
  - apply_diff 添加兜底全局搜索替换机制

## [1.0.74] - 2026-02-06

### Improved
  - apply_diff：unified patch 支持“裸 @@”hunk 头（无行号）时自动退化为全局精确 search/replace 应用，提升兼容性
  - apply_diff 工具面板/历史预览：增强对“裸 @@ / 无前缀行”的展示兜底

## [1.0.73] - 2026-02-05

### Improved
  - 优化了todo工具和实现方式，请务必重置一下**所有模式的动态上下文模板**，以便使用todo list

## [1.0.72] - 2026-02-05

### Improved
  - 优化了新diff格式的提示词，减少失败概率

## [1.0.71] - 2026-02-05

### Added
  - 添加了新的diff格式，且默认使用新diff格式。新格式成功率更高，依旧可以在设置里使用旧格式

### Fixed
  - 修复gemini格式工具响应无法正常发送的问题

## [1.0.70] - 2026-02-04

### Added
  - 添加plan/build模式（测试版，暂时有很多bug）

## [1.0.69] - 2026-01-28

### Fixed
  - 修正diff配置的遗漏问题

## [1.0.68] - 2026-01-27

### Fixed
  - 修复配置未持久化问题

## [1.0.67] - 2026-01-27

### Improved
  - 迁移至 VSCode 原生配置以支持 Settings Sync

## [1.0.66] - 2026-01-24

### Fixed
  - 修复拖选添加文件时路径问题报错导致的添加失败

## [1.0.65] - 2026-01-24

### Added
  - 添加了代码块自动换行显示的功能

## [1.0.64] - 2026-01-24

### Improved
  - 优化前端显示历史消息，变得更流畅，避免全量加载

## [1.0.63] - 2026-01-24

### Improved
  - 移除了附件大小限制（仍可能受vscode本身限制）

### Fixed
  - 修复换行视图上移问题
  - 修复中断报错时的前端索引问题

## [1.0.62] - 2026-01-22

### Fixed
  - 修复子代理创建后无法删除的问题

## [1.0.61] - 2026-01-22

### Added
  - 添加了选中文件里某一部分添加到上下文的功能，可以在选中要添加的代码后，悬停在代码上面，或者点击左侧的灯泡添加到输入框中。后续会扩展更多其他的添加上下文功能

## [1.0.60] - 2026-01-22

### Improved
  - 拆分解耦了输入框组件，使其更简洁

## [1.0.59] - 2026-01-21

### Added
  - 添加了编辑消息面板的"@"菜单
  - 添加了附件消息文件内容的功能
  - 将拖拽和"@"菜单内容做成了两个功能，按住ctrl使用原来的添加路径提示词，不按ctrl则表示直接添加文件内容进提示词

### Improved
  - 重构了输入框的代码，现在可以支持插入更多模块的提示词了
  - 优化了添加文件时的图标显示，改成更符合其文件扩展名的图标

## [1.0.58] - 2026-01-20

### Added
  - 添加了使用"@"选择文件时，打开标签页的高亮显示和优先排序

## [1.0.57] - 2026-01-20

### Fixed
  - 修复ctrl+s保存后diff状态清除不完全的问题
  - 修复Latex公式显示问题

## [1.0.56] - 2026-01-20

### Improved
  - 重构了工具的状态和执行逻辑

### Fixed
  - 修复了思考内容的字体显示问题

## [1.0.55] - 2026-01-20

### Added
  - 添加了 Mermaid 图表 显示支持

### Fixed
  - 修复了生成图片时路径和图片格式不一致的问题

## [1.0.54] - 2026-01-19

### Fixed
  - 修复了"@"菜单里使用↑↓按键无作用的问题

## [1.0.53] - 2026-01-19

### Added
  - 添加了快速回顶/回底按钮，添加了滚动动画

### Fixed
  - 修复了获取模型列表时没有走设置的网络代理的问题

## [1.0.52] - 2026-01-19

### Added
  - 添加了外观设置面板，添加了等待的文字配置项，可以自己配置显示文字，而不使用Loading

### Improved
  - 优化了历史对话加载方式，改为分页加载，减少等待时间

### Fixed
  - 修复了前端中断消息时，流式动画未消失的问题

## [1.0.51] - 2026-01-19

### Added
  - 添加了diff时修改文件内容的支持，同时会告诉ai手动修改了哪些内容

### Improved
  - 优化了读取类工具的换行符读取，使用\n而不再是\r\n，会更节省token和上下文
  - 优化了等待ai响应的动画

### Fixed
  - 修复了写入文件，搜索内容两个工具的diff中断问题，并采取了更稳健和兜底的中断机制
  - 修复了ai使用apply diff工具没有输出行号时的兜底机制没有工作的问题
  - 修复了diff工具文字显示问题

## [1.0.50] - 2026-01-19

### Fixed
  - 修复总结上下文总是带全部历史的问题
  - 发送时过滤掉空的thought块，以格式更正确
  - 修复了发送消息时的token重复计数问题

### Improved
  - 优化了默认的动态提示词，请务必去设置-提示词页签里**重置一下动态提示词**

## [1.0.49] - 2026-01-18

### Added
  - 添加了diff的全部应用和部分应用功能。对于部分应用，可以通过点击diff视图左侧的小灯泡来应用对应部分的diff，或者通过右上角的按钮来一次性保存多个diff块

### Improved
  - 移除搜索的dryrun模式
  - 优化了diff类工具的显示和逻辑，使用统一的diff逻辑，包括apply diff，write file，search in file

### Fixed
  - 修复部分拒绝工具，切换对话、中断工具等复杂情况时的竞态问题
  - 修复需要批准执行的工具造成的索引问题
  - 修复了diff类工具多个diff块时的行号问题

## [1.0.48] - 2026-01-17

### Fixed
  - 修复子代理工具的文字显示问题

## [1.0.47] - 2026-01-17

### Added
  - 添加了子代理工具，现在ai可以分任务给子代理，可以在设置中自行添加不同的agent

### Improved
  - 优化了搜索替换工具的显示和工具定义
  - 优化了token计数api的调用，改为并行调用节省时间

### Fixed
  - 优化了oai response接口的请求体结构
  - 修复了部分工具调用结果拒绝时没有添加响应的问题

## [1.0.46] - 2026-01-16

### Added
  - 添加了模式选择按钮，现在可以自己修改并保存不同的系统提示词和动态提示词为模版并持久保存了

### Fixed
  - 修复ssh时拖拽固定文件路径的问题，以及拖拽ssh拖拽添加文件到输入框的路径问题

## [1.0.45] - 2026-01-16

### Fixed
  - 修复了MCP Studio类型的注册问题，测试使用python、npx、uvx均正常

## [1.0.44] - 2026-01-14

### Improved
  - 优化了动态提示词的插入算法，改为插入到回合之前，避免破坏回合完整性

## [1.0.43] - 2026-01-11

### Improved
  - 优化了提示词，由于提示词更新，所以尽量去前端提示词面板里**重置系统和动态提示词**

## [1.0.42] - 2026-01-11

### Added
  - 初步添加了动态skills功能

## [1.0.41] - 2026-01-10

### Improved
  - 优化了提示词，由于提示词更新，所以尽量去前端提示词面板里**重置系统和动态提示词**
  - 优化了裁剪上下文的逻辑

## [1.0.40] - 2026-01-10

### Improved
  - 优化了变量加载方式，改为在末尾，以便缓存命中，同时优化了提示词结构
  - 优化了前端提示词配置面板，以顺应新更改
  - 由于提示词更新，所以尽量去前端提示词面板里**重置系统和动态提示词**
  - 添加了版本更新公告功能

## [1.0.39] - 2026-01-10

### Fixed
  - 修复图像生成类工具的api调用不传递role的问题

## [1.0.38] - 2026-01-08

### Fixed
  - 修复cmd工具无法执行的问题

## [1.0.37] - 2026-01-08

### Fixed
  - 修复了报错后点击重试按钮无响应的问题

## [1.0.36] - 2026-01-08

### Fixed
  - 修复了搜索工具的显示内容问题
  - 修复了cmd终端类型引号参数问题
  - 修复了搜索工具无法指定单个文件内搜索的问题

### Improved
  - 优化了初始化时按钮的线程堵塞问题
  - 添加了加载历史对话的等待动画
  - 优化了一个大文件，进行了拆分解耦

## [1.0.35] - 2026-01-07

### Added
  - 添加了输入框里"@"选择路径功能

### Fixed
  - 修复中断后点击继续按钮无法继续问题
  - 修复工具显示问题
  - 修复工具分类问题
  - 修复裁剪上下文问题
  - 修复部分情况下思考签名的存储问题
  - 修复文件夹文件不显示末尾/的问题
  - 修复cmd运行问题
  - 修复中断后点击继续无响应的问题
  - 修复上面三种工具显示问题

## [1.0.34] - 2026-01-07

### Added
  - 添加了find_references、get_symbols、goto_definition工具
  - 添加了read_file工具带行号的阅读功能，这可能会导致旧对话旧的读取文件块显示异常，建议开新对话

## [1.0.33] - 2026-01-07

### Improved
  - 优化了两个大文件，进行了拆分解耦

## [1.0.32] - 2026-01-06

### Improved
  - 优化了oai-responses格式，使其更符合官方示例

## [1.0.31] - 2026-01-06

### Fixed
  - 修复终端工具编码显示异常问题

## [1.0.30] - 2026-01-05

### Added
  - 添加openai-responses格式对话和token计数支持

## [1.0.29] - 2026-01-01

### Backed
  - 暂时回档到1.0.26

## [1.0.28] - 2025-12-31

### Fixed
  - 修复diff无法自动确认问题

## [1.0.27] - 2025-12-31

### Added
  - 支持工具确认后的分步批注提交

### Fixed
  - 修复总结对话后functionCall被错误裁剪

## [1.0.26] - 2025-12-31

### Fixed
  - 修复存档点问题
  - 修复自定义body时的合并问题

## [1.0.25] - 2025-12-26

### Added
  - 添加回退存档点二次确认功能

## [1.0.24] - 2025-12-26

### Added
  - 在工具确认界面支持读取输入框内容作为批注发送给 AI
  - 当有待确认工具时，发送输入框内容将自动触发“全部拒绝”并带上批注消息
  - 后端 ChatHandler 支持在处理工具结果前插入用户批注消息并重新计算 Token
  - 优化 diff 管理器：在非自动保存模式下，用户手动保存文件后自动关闭 diff 标签页
  - 前端chatStore 增加待确认工具检测逻辑及 rejectPendingToolsWithAnnotation 方法
  - 调整输入框逻辑，允许在工具待确认状态下发送文本内容

### Fixed
  - 修复输入框无法右键粘贴问题，简单模式”下，支持使用 a.b.c 这样的键名

## [1.0.23] - 2025-12-25

### Improved
  - 优化apply diff等工具的存储和显示以及实现

## [1.0.22] - 2025-12-23

### Fixed
  - 修复输入框以及长对话时卡顿问题，引入消息分页，每次多加载40条

## [1.0.21] - 2025-12-22

### Fixed
  - 修复oai格式流式响应中提取token计数问题

## [1.0.20] - 2025-12-22

### Fixed
  - 修复oai格式，Anthropic格式的工具调用格式和显示问题

## [1.0.19] - 2025-12-22

### Fixed
  - 修复终止按钮以及思考消息存储和前端显示问题

## [1.0.18] - 2025-12-22

### Fixed
  - 修复思考删除消息

## [1.0.17] - 2025-12-22

### Fixed
  - 修复文件扩展名识别问题，添加兜底机制
  - 修复空目录的增量备份问题

## [1.0.16] - 2025-12-22

### Added
  - 添加token计数api配置面板

### Improved
  - 大幅优化token计数方法
  - 大幅优化裁剪上下文功能


## [1.0.15] - 2025-12-21

### Fixed
  - 修复开关返回图片给ai时刷新多模态工具配置问题
  - 修复工具调用块里思维链存储和返回问题

## [1.0.14] - 2025-12-21

### Fixed
  - 暂时修复多工具确认问题

## [1.0.13] - 2025-12-21

### Fixed
- 修复提示词的刷新规则，每次循环都刷新
- 修复总结对话问题

## [1.0.12] - 2025-12-21

### Added
  - 新增发送前估算token功能
  - 新增额外裁剪功能
  - 新增发送历史对话思考时，控制发送对话轮数的功能

### Fixed
  - 修复历史思考签名回传开关的问题
  - 修复token计算问题，现在会实时裁剪上下文
  - 修复不同渠道的发送思考问题

### Improved
  - 优化了历史思维链回传说明
  - 优化了写入文件，应用差异工具的diff预览问题


## [1.0.11] - 2025-12-21

### Fixed
  - 修复工具格式和解析不匹配问题

### Improved
  - 优化了系统提示词

## [1.0.10] - 2025-12-21

### Improved
  - 优化了系统提示词

### Fixed
  - 修复抓包问题
  - 修复保存正文签名问题
  - 修复总结上下文后使用token不对问题
  - 修复裁剪上下文问题

## [1.0.9] - 2025-12-20

### Added
  - 新增单回合最大工具调用次数配置
  - 在工具设置面板中添加配置项，允许用户自定义每轮对话中 AI 最多可调用的工具次数
  - 默认值为 50，-1 表示无限制

### Improved
  - 优化工具设置面板的数字输入框样式，隐藏上下箭头按钮

### Fixed
  - 修复工具参数验证问题：强调所有数组类型参数必须使用数组格式（即使只有单个值）
  - 文件工具：read_file、write_file、list_files、delete_file、create_directory、apply_diff
  - 搜索工具：find_files
  - 媒体工具：generate_image、resize_image、rotate_image、crop_image、remove_background
  - 修复 AI 调用时出现 `Malformed function call` 错误的问题

## [1.0.8] - 2025-12-20

### Fixed
  - 修复增量存档，始终使用


## [1.0.7] - 2025-12-20

### Added
  - 新增自定义存储路径功能
  - 支持在通用设置中配置自定义存储路径，用于存放对话历史、存档点等数据
  - 支持路径验证和数据迁移功能
  - 可将现有数据迁移到新的存储位置
  - 为搜索工具添加替换功能

### Fixed
  - 修复上下文阈值在有总结消息时不生效的问题
  - 原逻辑：发现总结消息后直接从总结开始返回历史，跳过上下文阈值检查
  - 修复后：即使有总结消息，也会继续检查 token 数是否超过阈值，超过时会对总结后的历史进行回合裁剪
  - 修复 apply_diff 工具前端缩略视图行号始终从 1 开始的问题
  - 将 `start_line` 参数改为必填，要求 AI 必须提供准确的起始行号
  - 后端返回带有实际匹配行号的 diffs 供前端显示
  - 前端优先使用后端返回的 diffs 数据（包含实际匹配行号）
  - 修复diff差异工具的显示问题，优化diff工具的存储

### Improved
  - 优化大部分工具定义和响应
  - 改为使用增量备份功能
  - 添加更多md渲染支持

## [1.0.6] - 2025-12-19

### Fixed
- 修复上下文总结功能发送给 API 时包含无效字段的问题（如 `functionCall.rejected`、`inlineData.id/name` 等内部字段）
- 修复 apply_diff 工具前端面板中行号从 0 开始显示的问题，现在正确使用 `start_line` 作为起始行号

### Improved
- 优化总结请求的字段清理，过滤思考内容和思考签名，保持与 `getHistoryForAPI` 一致的清理逻辑
- 改进 apply_diff 工具的"查看差异"按钮功能，现在点击后在 VSCode 中显示完整文件的差异视图（包含完整代码上下文），而不仅仅是 search/replace 块
- 改进切换对话时的自动滚动逻辑
- 前端添加取消兜底机制，避免一直显示等待

## [1.0.5] - 2025-12-19

### Improved
- 优化生图工具（generate_image）描述，添加提示说明生成的图片是实色背景而非透明底图

## [1.0.4] - 2025-12-19

### Fixed
- 修复工具执行完成后点击终止按钮无法正常结束的问题（循环开始时检测取消信号后需发送 cancelled 消息给前端）

### Improved
- 优化搜索工具（find_files、search_in_files）忽略问题，添加默认排除模式配置

## [1.0.3] - 2025-12-19

### Added
- 添加了向 AI 发送诊断信息功能

### Fixed
- 修复上下文感知页面保存问题

### Note
- ⚠️ 旧版本使用者建议重置系统提示词以添加诊断信息功能

## [1.0.0] - 2025-12-19

### Added
- 🎉 首次发布
- AI 编程助手核心功能
- 多模态支持
- 对话历史管理
- 多语言支持（中文、英文、日文）
- MCP 服务器集成
- 文件操作工具
- 终端命令执行
- 图像处理功能